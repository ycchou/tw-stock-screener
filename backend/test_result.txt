============================= test session starts =============================
platform win32 -- Python 3.13.5, pytest-9.0.2, pluggy-1.6.0 -- D:\Antigravity\tw-stock-screener\backend\venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: D:\Antigravity\tw-stock-screener\backend
plugins: anyio-4.12.1, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 6 items

tests/test_integration.py::test_root_access FAILED                       [ 16%]
tests/test_integration.py::test_index_html_access FAILED                 [ 33%]
tests/test_integration.py::test_js_resource_access FAILED                [ 50%]
tests/test_integration.py::test_css_resource_access PASSED               [ 66%]
tests/test_integration.py::test_sw_resource_access PASSED                [ 83%]
tests/test_integration.py::test_api_docs_access PASSED                   [100%]

================================== FAILURES ===================================
______________________________ test_root_access _______________________________

    def test_root_access():
        """【單一端口驗證】根路徑訪問測試"""
        response = client.get("/")
        assert response.status_code == 200
>       assert "<html" in response.text.lower()
E       assert '<html' in '{"message":"台股均線糾結篩選器 api","version":"1.0.0"}'
E        +  where '{"message":"台股均線糾結篩選器 api","version":"1.0.0"}' = <built-in method lower of str object at 0x00000234E50AC170>()
E        +    where <built-in method lower of str object at 0x00000234E50AC170> = '{"message":"台股均線糾結篩選器 API","version":"1.0.0"}'.lower
E        +      where '{"message":"台股均線糾結篩選器 API","version":"1.0.0"}' = <Response [200 OK]>.text

tests\test_integration.py:20: AssertionError
___________________________ test_index_html_access ____________________________

    def test_index_html_access():
        """【單一端口驗證】index.html 訪問測試"""
        response = client.get("/index.html")
        assert response.status_code == 200
>       assert response.text == client.get("/").text
E       assert '<!DOCTYPE ht...\n\r\n</html>' == '{"message":"...ion":"1.0.0"}'
E         
E         - {"message":"台股均線糾結篩選器 API","version":"1.0.0"}
E         + <!DOCTYPE html>
E         + <html lang="zh-TW">
E         + 
E         + <head>
E         +     <meta charset="UTF-8">...
E         
E         ...Full output truncated (259 lines hidden), use '-vv' to show

tests\test_integration.py:27: AssertionError
___________________________ test_js_resource_access ___________________________

    def test_js_resource_access():
        """【靜態資源驗證】JavaScript 檔案載入測試"""
        # 測試一個實際存在的 JS 檔案，例如 app.js 或 chart.js
        # 我們先假設 js/app.js 存在 (根據專案結構)
        response = client.get("/js/app.js")
        assert response.status_code == 200, f"Status: {response.status_code}, Body: {response.text[:100]}"
>       assert "application/javascript" in response.headers["content-type"].lower()
E       AssertionError: assert 'application/javascript' in 'text/javascript; charset=utf-8'
E        +  where 'text/javascript; charset=utf-8' = <built-in method lower of str object at 0x00000234E512FE60>()
E        +    where <built-in method lower of str object at 0x00000234E512FE60> = 'text/javascript; charset=utf-8'.lower

tests\test_integration.py:35: AssertionError
=========================== short test summary info ===========================
FAILED tests/test_integration.py::test_root_access - assert '<html' in '{"mes...
FAILED tests/test_integration.py::test_index_html_access - assert '<!DOCTYPE ...
FAILED tests/test_integration.py::test_js_resource_access - AssertionError: a...
========================= 3 failed, 3 passed in 0.36s =========================
